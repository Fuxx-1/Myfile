<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>简易聊天室</title>
        <style>
            * {
                padding: 0;
                margin: 0;
            }

            body {
                background-position: center;
                background-size: cover;
                background-repeat: no-repeat;
                background-attachment: fixed;
                width: 100vw;
                height: 100vh;
            }

            .dia-content {
                width: 100vw;
                height: calc(100vh - 50px);
                box-sizing: border-box;
                padding: 50px 50px;
            }

            .input-box {
                width: 100vw;
                height: 50px;
                line-height: 50px;
                display: flex;
                padding: 11px 20px;
                box-sizing: border-box;
            }

            button {
                width: 50px;
            }

            input {
                flex: 1;
                margin-right: 10px;
            }

            .Me {
                text-align: right;
                color: red;
            }

            p {
                font-size: 17px;
                margin-top: 5px;
            }
        </style>
    </head>

    <body>
        <div class="dia-content">
        </div>
        <div class="input-box">
            <input type="text">
            <button>发送</button>
        </div>
        <script src="https://cdn.bootcdn.net/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
        <script>
            const content = document.getElementsByClassName('dia-content')[0];
            const input = document.getElementsByTagName('input')[0];
            var myMM = "";

            function send(str) {
                var p = document.createElement('p');
                p.className = "Me";
                p.innerText = str;
                content.appendChild(p);
                myMM = str;
                meObj.message = myMM;
                meObj.friendId = friend;
                meObj.groupId = null;
                console.log(JSON.stringify(meObj));
                connect.send(JSON.stringify(meObj));
            }

            function get(str) {
                var p = document.createElement('p');
                p.innerText = str;
                content.appendChild(p);
            }

            function a() {
                if (!input.value) {
                    return 0;
                }
                send(input.value);
                input.value = "";
            }
            document.getElementsByTagName('button')[0].onclick = a;
            input.onkeyup = function(e) {
                e = e || window.event;
                var kc = e.keyCode;
                if (kc == 13 && input.value !== "") {
                    a();
                }
            }
            // var socket = io.connect('http://192.168.1.178:8080/chat/' + "88888888");
            // socket.on('message', function(mm) {
            //     if (mm == myMM) {
            //         return 0;
            //     }
            //     get(mm);
            // })
            const url = "ws://localhost:8081/chat";
            var id = "12345";
            id = prompt("我的id");
            var friend = "88888888";
            friend = prompt("盆友id");
            friend = parseInt(friend);
            var meObj = {
                // groupId,
                // friendId,
                // message,
            }

            var connect = new WebSocket(url);
            connect.onmessage = function(e) {
                const data = JSON.parse(e.data);
                if (data.msg == myMM) {
                    return 0;
                }
                get(data.msg);
                console.log(data);
            }
        </script>
    </body>

</html>
<!--        <title>Title</title>-->
<!--        <style type="text/css">-->
<!--            .greenTxt{ color:#008200;}-->
<!--            .redTxt{ color:#820803; }-->
<!--        </style>-->
<!--        <script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>-->
<!--        <script src="js/MyWebsocket.js"></script>-->
<!--        <script>-->
<!--            var ws;-->
<!--            $(document).ready(function(){-->
<!--                var $content = $("#content");-->
<!--                window.GLOBAL_SOCKET_CONNECT_ID = random( 25 );-->
<!--                ws = new MyWebSocket("messagePusher",{-->
<!--                    params: {-->
<!--                        JCONNECTID : window.GLOBAL_SOCKET_CONNECT_ID,-->
<!--                    },-->
<!--                    onmessage: function (messagestr) {-->
<!--                        var content = JSON.parse(messagestr);-->
<!--                        $content.append("<pre>"+content.data+"</pre>");-->
<!--                    },-->
<!--                    onopen: function() {-->
<!--                        $content.append("<p class='greenTxt'>SOCKET已连接上...</p>");-->
<!--                    },-->
<!--                    onclose: function() {-->
<!--                        $content.append("<p class='redTxt'>SOCKET连接已中断!</p>");-->
<!--                    },-->
<!--                    onerror: function(err) {-->
<!--                        $content.append("<pre>"+err+"</pre>");-->
<!--                    }-->
<!--                });-->
<!--            });-->

<!--            function random(len) {-->
<!--                len = len || 32;-->
<!--                /****默认去掉了容易混淆的字符oOLl,9gq,Vv,Uu,I1****/-->
<!--                var $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';-->
<!--                var $maxPos = $chars.length;-->
<!--                var $data = '';-->
<!--                for (i = 0; i < len; i++) {-->
<!--                    $data += $chars.charAt(Math.floor(Math.random() * $maxPos));-->
<!--                }-->
<!--                return $data;-->
<!--            }-->
<!--        </script>-->
<!--    </head>-->
<!--    <body>-->
<!--        <div id="content"></div>-->
<!--    </body>-->
<!--</html>-->